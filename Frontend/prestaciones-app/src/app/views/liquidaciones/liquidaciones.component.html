<div class="liquidaciones-container">
  <div class="header">
    <h1>C√°lculo de Liquidaci√≥n Laboral</h1>
    <button 
      *ngIf="tieneResultado"
      class="btn btn-secondary" 
      (click)="nuevaLiquidacion()"
      [disabled]="loadingCalculo">
      <i class="icon">üîÑ</i>
      Nueva Liquidaci√≥n
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="icon">‚ö†Ô∏è</i>
    {{ errorMessage }}
  </div>
  <div *ngIf="successMessage" class="alert alert-success">
    <i class="icon">‚úÖ</i>
    {{ successMessage }}
  </div>

  <!-- Loading -->
  <div *ngIf="loadingEmpleados" class="loading">
    <div class="spinner"></div>
    <p>Cargando empleados...</p>
  </div>

  <!-- Formulario de C√°lculo -->
  <div class="form-section" *ngIf="!loadingEmpleados">
    <div class="card">
      <div class="card-header">
        <h2>Datos para el C√°lculo</h2>
        <p>Selecciona al empleado y la fecha de egreso para calcular su liquidaci√≥n</p>
      </div>
      
      <form [formGroup]="liquidacionForm" (ngSubmit)="onSubmit()" class="card-body">
        <div class="form-row">
          <div class="form-group">
            <label for="idEmpleado">Empleado *</label>
            <select 
              id="idEmpleado" 
              formControlName="idEmpleado"
              [class.error]="hasError('idEmpleado', 'required')">
              <option value="">-- Seleccionar Empleado --</option>
              <option 
                *ngFor="let empleado of empleados" 
                [value]="empleado.idEmpleado">
                {{ empleado.nombres }} {{ empleado.apellidos }} ({{ empleado.dpi }})
              </option>
            </select>
            <div *ngIf="hasError('idEmpleado', 'required')" class="error-message">
              Debe seleccionar un empleado
            </div>
          </div>

          <div class="form-group">
            <label for="fechaEgreso">Fecha de Egreso *</label>
            <input 
              id="fechaEgreso"
              type="date" 
              formControlName="fechaEgreso"
              [class.error]="hasError('fechaEgreso', 'required')">
            <div *ngIf="hasError('fechaEgreso', 'required')" class="error-message">
              La fecha de egreso es obligatoria
            </div>
          </div>
        </div>

        <!-- Informaci√≥n del Empleado Seleccionado -->
        <div *ngIf="empleadoSeleccionado" class="empleado-info">
          <h3>Informaci√≥n del Empleado</h3>
          <div class="info-grid">
            <div class="info-item">
              <strong>Nombre:</strong> 
              {{ empleadoSeleccionado.nombres }} {{ empleadoSeleccionado.apellidos }}
            </div>
            <div class="info-item">
              <strong>DPI:</strong> 
              {{ empleadoSeleccionado.dpi }}
            </div>
            <div class="info-item">
              <strong>Fecha de Ingreso:</strong> 
              {{ formatDate(empleadoSeleccionado.fechaIngreso) }}
            </div>
            <div class="info-item">
              <strong>Salario Base:</strong> 
              {{ formatCurrency(empleadoSeleccionado.salarioBase) }}
            </div>
            <div class="info-item" *ngIf="empleadoSeleccionado.promComisiones">
              <strong>Promedio Comisiones:</strong> 
              {{ formatCurrency(empleadoSeleccionado.promComisiones) }}
            </div>
            <div class="info-item" *ngIf="empleadoSeleccionado.bonoIncentivo">
              <strong>Bono Incentivo:</strong> 
              {{ formatCurrency(empleadoSeleccionado.bonoIncentivo) }}
            </div>
            <div class="info-item" *ngIf="liquidacionForm.value.fechaEgreso">
              <strong>D√≠as de Relaci√≥n Laboral:</strong> 
              {{ calcularDiasRelacion() }} d√≠as
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="limpiarFormulario()"
            [disabled]="loadingCalculo">
            Limpiar
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="!isFormValid || loadingCalculo">
            <span *ngIf="loadingCalculo" class="spinner-sm"></span>
            <i *ngIf="!loadingCalculo" class="icon">üí∞</i>
            {{ loadingCalculo ? 'Calculando...' : 'Calcular Liquidaci√≥n' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Resultados de Liquidaci√≥n -->
  <div *ngIf="resultado" class="results-section">
    <div class="card">
      <div class="card-header">
        <h2>Resultado de Liquidaci√≥n</h2>
        <p>{{ empleadoActual?.nombres }} {{ empleadoActual?.apellidos }}</p>
      </div>
      
      <div class="card-body">
        <div class="results-grid">
          <!-- Informaci√≥n General -->
          <div class="result-section">
            <h3>Informaci√≥n General</h3>
            <div class="result-item">
              <span class="label">ID Liquidaci√≥n:</span>
              <span class="value">{{ resultado.idLiquidacion }}</span>
            </div>
            <div class="result-item">
              <span class="label">Fecha de C√°lculo:</span>
              <span class="value">{{ formatDate(resultado.fechaCalculo) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Fecha de Egreso:</span>
              <span class="value">{{ formatDate(resultado.fechaEgreso) }}</span>
            </div>
            <div class="result-item">
              <span class="label">D√≠as de Relaci√≥n:</span>
              <span class="value">{{ resultado.diasRelacion }} d√≠as</span>
            </div>
          </div>

          <!-- Conceptos de Liquidaci√≥n -->
          <div class="result-section">
            <h3>Conceptos de Liquidaci√≥n</h3>
            <div class="result-item">
              <span class="label">Salario Devengado:</span>
              <span class="value amount">{{ formatCurrency(resultado.salarioDevengado) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Indemnizaci√≥n:</span>
              <span class="value amount">{{ formatCurrency(resultado.indemnizacion) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Vacaciones:</span>
              <span class="value amount">{{ formatCurrency(resultado.vacaciones) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Aguinaldo:</span>
              <span class="value amount">{{ formatCurrency(resultado.aguinaldo) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Bono 14:</span>
              <span class="value amount">{{ formatCurrency(resultado.bono14) }}</span>
            </div>
            <div class="result-item">
              <span class="label">Ventajas Econ√≥micas:</span>
              <span class="value amount">{{ formatCurrency(resultado.ventajasEconomicas) }}</span>
            </div>
          </div>
        </div>

        <!-- Total -->
        <div class="total-section">
          <div class="total-item">
            <span class="label">TOTAL A PAGAR:</span>
            <span class="value total-amount">{{ formatCurrency(resultado.totalPagar) }}</span>
          </div>
        </div>

        <!-- Acciones de Resultado -->
        <div class="result-actions">
          <button class="btn btn-secondary" onclick="window.print()">
            <i class="icon">üñ®Ô∏è</i>
            Imprimir
          </button>
          <button class="btn btn-primary" (click)="nuevaLiquidacion()">
            <i class="icon">‚ûï</i>
            Nueva Liquidaci√≥n
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado vac√≠o -->
  <div *ngIf="!loadingEmpleados && empleados.length === 0" class="empty-state">
    <i class="icon">üë•</i>
    <h3>No hay empleados activos</h3>
    <p>Para calcular liquidaciones, primero debe tener empleados registrados en estado activo.</p>
    <a routerLink="/empleados" class="btn btn-primary">
      <i class="icon">‚ûï</i>
      Ir a Gesti√≥n de Empleados
    </a>
  </div>
</div>

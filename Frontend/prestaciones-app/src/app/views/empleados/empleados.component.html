<div class="empleados-container">
  <div class="header">
    <h1>Gesti√≥n de Empleados</h1>
    <button 
      class="btn btn-primary" 
      (click)="mostrarFormularioNuevo()"
      [disabled]="loading">
      <i class="icon">‚ûï</i>
      Nuevo Empleado
    </button>
  </div>

  <!-- Mensajes -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>

  <!-- Formulario Modal -->
  <div *ngIf="showForm" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2>{{ editMode ? 'Editar Empleado' : 'Nuevo Empleado' }}</h2>
        <button class="btn-close" (click)="ocultarFormulario()">‚úï</button>
      </div>
      
      <form [formGroup]="empleadoForm" (ngSubmit)="onSubmit()" class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label for="dpi">DPI *</label>
            <input 
              id="dpi"
              type="text" 
              formControlName="dpi"
              placeholder="1234567890123"
              [class.error]="hasError('dpi', 'required') || hasError('dpi', 'minlength')">
            <div *ngIf="hasError('dpi', 'required')" class="error-message">
              El DPI es obligatorio
            </div>
            <div *ngIf="hasError('dpi', 'minlength')" class="error-message">
              El DPI debe tener 13 caracteres
            </div>
          </div>

          <div class="form-group">
            <label for="estado">Estado *</label>
            <select id="estado" formControlName="estado">
              <option value="ACTIVO">ACTIVO</option>
              <option value="INACTIVO">INACTIVO</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="nombres">Nombres *</label>
            <input 
              id="nombres"
              type="text" 
              formControlName="nombres"
              placeholder="Juan Carlos"
              [class.error]="hasError('nombres', 'required') || hasError('nombres', 'minlength')">
            <div *ngIf="hasError('nombres', 'required')" class="error-message">
              Los nombres son obligatorios
            </div>
          </div>

          <div class="form-group">
            <label for="apellidos">Apellidos *</label>
            <input 
              id="apellidos"
              type="text" 
              formControlName="apellidos"
              placeholder="Garc√≠a L√≥pez"
              [class.error]="hasError('apellidos', 'required') || hasError('apellidos', 'minlength')">
            <div *ngIf="hasError('apellidos', 'required')" class="error-message">
              Los apellidos son obligatorios
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fechaIngreso">Fecha de Ingreso *</label>
            <input 
              id="fechaIngreso"
              type="date" 
              formControlName="fechaIngreso"
              [class.error]="hasError('fechaIngreso', 'required')">
            <div *ngIf="hasError('fechaIngreso', 'required')" class="error-message">
              La fecha de ingreso es obligatoria
            </div>
          </div>

          <div class="form-group" *ngIf="editMode">
            <label for="fechaEgreso">Fecha de Egreso</label>
            <input 
              id="fechaEgreso"
              type="date" 
              formControlName="fechaEgreso">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="salarioBase">Salario Base *</label>
            <input 
              id="salarioBase"
              type="number" 
              step="0.01"
              min="0"
              formControlName="salarioBase"
              placeholder="0.00"
              [class.error]="hasError('salarioBase', 'required') || hasError('salarioBase', 'min')">
            <div *ngIf="hasError('salarioBase', 'required')" class="error-message">
              El salario base es obligatorio
            </div>
            <div *ngIf="hasError('salarioBase', 'min')" class="error-message">
              El salario debe ser mayor a 0
            </div>
          </div>

          <div class="form-group">
            <label for="promComisiones">Promedio Comisiones</label>
            <input 
              id="promComisiones"
              type="number" 
              step="0.01"
              min="0"
              formControlName="promComisiones"
              placeholder="0.00">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="bonoIncentivo">Bono Incentivo</label>
            <input 
              id="bonoIncentivo"
              type="number" 
              step="0.01"
              min="0"
              formControlName="bonoIncentivo"
              placeholder="0.00">
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="ocultarFormulario()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="empleadoForm.invalid || loading">
            {{ editMode ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla de Empleados -->
  <div class="table-container" *ngIf="!loading">
    <table class="empleados-table">
      <thead>
        <tr>
          <th>DPI</th>
          <th>Nombre Completo</th>
          <th>Fecha Ingreso</th>
          <th>Fecha Egreso</th>
          <th>Salario Base</th>
          <th>Comisiones</th>
          <th>Bono Incentivo</th>
          <th class="highlight">Salario Devengado</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let empleado of empleados">
          <!-- DPI del empleado -->
          <td>{{ empleado.dpi }}</td>
          
          <!-- Nombre completo -->
          <td>{{ empleado.nombres }} {{ empleado.apellidos }}</td>
          
          <!-- Fechas de ingreso y egreso -->
          <td>{{ formatDate(empleado.fechaIngreso) }}</td>
          <td>{{ formatDate(empleado.fechaEgreso || '') }}</td>
          
          <!-- Salario Base -->
          <td>{{ formatCurrency(empleado.salarioBase) }}</td>
          
          <!-- Promedio de Comisiones -->
          <td>{{ formatCurrency(empleado.promComisiones || 0) }}</td>
          
          <!-- Bono Incentivo -->
          <td>{{ formatCurrency(empleado.bonoIncentivo || 0) }}</td>
          
          <!-- Salario Devengado Total (SD = Base + Comisiones + Bono) -->
          <td class="total-devengado">
            {{ formatCurrency(calcularSalarioDevengado(empleado)) }}
          </td>
          
          <!-- Estado del empleado -->
          <td>
            <span [class]="'status ' + (empleado.estado === 'ACTIVO' ? 'active' : 'inactive')">
              {{ empleado.estado }}
            </span>
          </td>
          
          <!-- Botones de acciones -->
          <td class="actions">
            <button 
              class="btn btn-sm btn-secondary" 
              (click)="mostrarFormularioEditar(empleado)"
              [disabled]="loading"
              title="Editar empleado">
              <i class="icon">‚úèÔ∏è</i>
            </button>
            <button 
              class="btn btn-sm btn-danger" 
              (click)="eliminarEmpleado(empleado)"
              [disabled]="loading"
              title="Eliminar empleado">
              <i class="icon">üóëÔ∏è</i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="empleados.length === 0" class="empty-state">
      <p>No hay empleados registrados</p>
      <button class="btn btn-primary" (click)="mostrarFormularioNuevo()">
        Crear Primer Empleado
      </button>
    </div>
  </div>
</div>
